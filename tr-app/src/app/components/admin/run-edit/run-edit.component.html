<div class="container-fluid">
  <form [formGroup]="editForm" (ngSubmit)="onSubmit()" *ngIf="currentRun; else loading">
    <div class="row justify-content-center">
      <div class="col-lg-4 col-md-5 col-sm-12">
        <mat-form-field>
          <mat-label>Name</mat-label>
          <input matInput id="name" type="text" formControlName="name"/>
        </mat-form-field>
      </div>
      <div class="col-lg-4 col-md-5 col-sm-12">
        <mat-form-field>
          <mat-label>Event Date</mat-label>
          <input matInput type="datetime-local" name="eventDate" formControlName="eventDate">
        </mat-form-field>
      </div>
    </div>

    <div class="row justify-content-center">
      <div class="col-lg-2 col-md-3 col-sm-12">
        <mat-form-field>
          <mat-label>Run Type</mat-label>
          <mat-select formControlName="runType">
            <mat-option value="thursday-run">Thursday Run</mat-option>
            <mat-option value="saturday-5k">Saturday 5K</mat-option>
            <mat-option value="special-event">Special Event</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-lg-2 col-md-3 col-sm-12">
        <mat-form-field>
          <mat-label>Status</mat-label>
          <mat-select formControlName="status">
            <mat-option value="published">Published</mat-option>
            <mat-option value="pending">Pending</mat-option>
            <mat-option value="archived">Archived</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-lg-4 col-md-4 col-sm-12">
        <mat-form-field>
          <mat-label>Strava Route ID</mat-label>
          <input matInput id="stravaRouteId" type="text" formControlName="stravaRouteId"/>
        </mat-form-field>
      </div>
    </div>

    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10 col-sm-12">
        <div class="description-ngx">
          <ngx-editor-menu [editor]="editor" [toolbar]="toolbar"> </ngx-editor-menu>
          <ngx-editor [editor]="editor" formControlName="description" [placeholder]="'Description'" outputFormat="html"></ngx-editor>
        </div>
      </div>
    </div>

    <fieldset formGroupName="location">
      <div class="row justify-content-center">
        <div class="col-lg-4 col-md-5 col-sm-12">
          <mat-form-field>
            <mat-label>Location</mat-label>
            <mat-select formControlName="id" (selectionChange)="onLocationChange($event.value)">
              @for (location of locations$; track location.id; let i = $index) {
                <mat-option [value]="location.id">{{ location.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
          <button mat-raised-button color="primary" type="button" class="add-location-btn" (click)="openLocationDialog()">Edit Location</button>
        </div>
      </div>

      <div class="row justify-content-center">
        <div class="col-lg-4 col-md-5 col-sm-12">
          <mat-form-field>
            <mat-label>Street Address</mat-label>
            <input matInput id="streetAddress" type="text" formControlName="streetAddress"/>
          </mat-form-field>
        </div>
        <div class="col-lg-4 col-md-5 col-sm-12">
          <mat-form-field>
            <mat-label>Neighboorhood Name</mat-label>
            <input matInput id="neighborhood" type="text" formControlName="neighborhood"/>
          </mat-form-field>
        </div>
      </div>

      <div class="row justify-content-center">
        <div class="col-lg-4 col-md-4 col-sm-12">
          <mat-form-field>
            <mat-label>City</mat-label>
            <input matInput id="city" type="text" formControlName="city"/>
          </mat-form-field>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-12">
          <mat-form-field>
            <mat-label>State</mat-label>
            <input matInput id="state" type="text" formControlName="state"/>
          </mat-form-field>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-12">
          <mat-form-field>
            <mat-label>zipCode</mat-label>
            <input matInput id="zipCode" type="text" formControlName="zipCode"/>
          </mat-form-field>
        </div>
      </div>
    </fieldset>

    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10 col-sm-12">
        <button mat-raised-button color="primary" type="submit" [class.spinner]="saving" [disabled]="!editForm.valid || !editForm.dirty || saving">Update</button>
      </div>
    </div>
  </form>


  <ng-template #loading>
    <div class="row justify-content-center">
      <div class="col-2">
        <mat-spinner></mat-spinner>
      </div>
    </div>
  </ng-template>
</div>
